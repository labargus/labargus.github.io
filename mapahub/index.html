<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<title>Super herois</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.1/css/bulma.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.css">
	<script src="https://cdn.babylonjs.com/babylon.js"></script>
	<script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/animejs"></script>


	<style>
		html,
		body {
			overflow: hidden;
		}

		body {
			background-color: rgb(0, 0, 0);
		}

		canvas {
			width: 100vw;
			height: 100vh;
			overflow: hidden;
		}

		button {
			height: 60px;
			border-radius: 10px;
		}

		.botoes {
			width: 30%;
			display: flex;
			position: absolute;
			left: 10px;
			flex-direction: column;
			gap: 10px;
			overflow: hidden;
		}

		.layer {
			width: 100%;
			display: flex;
			justify-content: start;
			align-items: center;
			gap: 10px;
		}

		.screen {
			position: absolute;
			width: 100vw;
			height: 90vh;
			display: flex;
			justify-content: center;
			overflow: hidden;

		}

		.hide {
			display: none;
		}

		#info {
			position: absolute;
			bottom: 15%;
			left: 50%;
			transform: translate(-50%, -50%);
			background-color: #1f3f7a;
			border-color: grey;
			padding: 10px;
			border-radius: 5px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
		}
	</style>
</head>

<body>
	<div style="position: absolute;top: 0px;width: 100%;">
		<nav class="navbar" role="navigation" aria-label="main navigation">
			<div class="navbar-brand">
				<a class="navbar-item" href="#">
					<img src="marca_site.png" alt="Site Logo">

				</a>

				<a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"
					data-target="navbarBasicExample">
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
				</a>
			</div>
			<div id="navbarBasicExample" class="navbar-menu">
				<div class="navbar-start">
					<a class="navbar-item" onclick="location.reload()">
						Inicio
					</a>


					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-link">1 Andar</a>
						<div class="navbar-dropdown">
							<a id="btsala1" class="bt navbar-item">CWB - Sala Machado de Assis | 8 pessoas</a>
							<a id="btsala2" class="bt navbar-item">CWB - Sala Lauro de Oliveira Lima | 6 pessoas</a>
							<a id="btsala3" class="bt navbar-item">CWB - Sala Poty Lazzarotto | 8 pessoas</a>
							<a id="btsala4" class="bt navbar-item">CWB - Sala Enheduanna | 6 pessoas</a>
							<a id="btsala5" class="bt navbar-item">CWB - Sala Emília Ferreiro | 6 pessoas</a>
							<a id="btsala6" class="bt navbar-item">CWB - Sala Ana Miranda | 10 pessoas</a>
						</div>
					</div>

					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-link">1 Andar Mezanino</a>
						<div class="navbar-dropdown">
							<a id="btsala7" class="bt navbar-item">CWB - Sala Maria da Penha | 4 pessoas</a>
							<a id="btsala8" class="bt navbar-item">CWB - Sala Domingos Pellegrini | 4 pessoas</a>
							<a id="btsala9" class="bt navbar-item">CWB - Sala Mário de Andrade | 4 pessoas</a>
						</div>
					</div>
					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-link">1 Andar Mezanino Salão</a>
						<div class="navbar-dropdown">
							<a id="btsala10" class="bt navbar-item">CWB - Sala Darcy Ribeiro | 4 pessoas</a>
							<a id="btsala11" class="bt navbar-item">CWB - Sala Mário Sérgio Cortella | 4 pessoas</a>
							<a id="btsala12" class="bt navbar-item">CWB - Sala Hélio Leites | 2 pessoas</a>
							<a id="btsala13" class="bt navbar-item">CWB - Sala Hipátia | 2 pessoas</a>
							<a id="btsala14" class="bt navbar-item">CWB - Sala Magda Soares | 2 pessoas</a>
						</div>
					</div>
					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-link">2 Andar</a>
						<div class="navbar-dropdown">
							<a id="btsala15" class="bt navbar-item">CWB - Sala Alan Turing | 8 pessoas</a>
							<a id="btsala16" class="bt navbar-item">CWB - Sala Lady Murasaki | 4 pessoas</a>
							<a id="btsala17" class="bt navbar-item">CWB - Sala Marie Curie | 10 pessoas</a>
							<a id="btsala18" class="bt navbar-item">CWB - Sala Katherine Johnson | 4 pessoas</a>
							<a id="btsala19" class="bt navbar-item">CWB - Sala Isaac Newton | 4 pessoas</a>
							<a id="btsala20" class="bt navbar-item">CWB - Sala Zaha Hadid | 4 pessoas</a>
							<a id="btsala21" class="bt navbar-item">CWB - Arquibancada | 85 pessoas</a>
							<a id="btsala22" class="bt navbar-item">CWB - Sala Câmara Cascudo | 1 pessoa</a>
							<a id="btsala23" class="bt navbar-item">CWB - Sala Ariano Suassuna | 1 pessoa</a>
							<a id="btsala24" class="bt navbar-item">CWB - Sala César Lattes | 10 pessoas</a>
							<a id="btsala25" class="bt navbar-item">CWB - Sala Leonardo da Vinci | 25 pessoas</a>
							<a id="btsala26" class="bt navbar-item">CWB - Sala Ada Lovelace | 4 pessoas</a>
							<a id="btsala27" class="bt navbar-item">CWB - Sala Santos Dumont | 4 pessoas</a>
						</div>
					</div>
				</div>
				<div class="navbar-end">
					<div class="navbar-item">
						<button class="button is-primary"
							onclick="document.getElementById('searchModal').style.display='block'">
							<span class="icon">
								<i class="fas fa-search"></i>
							</span>
						</button>
						<div class="navbar-dropdown is-active">

						</div>
					</div>

				</div>
			</div>
		</nav>
	</div>
	<div class="modal" id="searchModal">
		<div class="modal-background"></div>
		<div class="modal-card">
			<header class="modal-card-head">
				<input id="searchInput" type="text" placeholder="Pesquisar aqui..." class="input is-secondary">
				<span class="icon">
					<i class="fas fa-search"></i>
				</span>

				<script>
					document.getElementById('searchInput').addEventListener('input', function () {
						var searchValue = this.value.toLowerCase();
						var buttons = document.querySelectorAll('.item-search');

						buttons.forEach(function (button) {
							if (button.textContent.toLowerCase().includes(searchValue)) {
								button.style.display = 'block';
							} else {
								button.style.display = 'none';
							}
						});
					});
				</script>
			</header>

			<section class="modal-card-body">
				<button id="btsearch1" class="item-search" style="display: none;">CWB - Sala Machado de Assis | 8
					pessoas</button>
				<button id="btsearch2" class="item-search" style="display: none;">CWB - Sala Lauro de Oliveira Lima | 6
					pessoas</button>
				<button id="btsearch3" class="item-search" style="display: none;">CWB - Sala Poty Lazzarotto | 8
					pessoas</button>
				<button id="btsearch4" class="item-search" style="display: none;">CWB - Sala Enheduanna | 6
					pessoas</button>
				<button id="btsearch5" class="item-search" style="display: none;">CWB - Sala Emília Ferreiro | 6
					pessoas</button>
				<button id="btsearch6" class="item-search" style="display: none;">CWB - Sala Ana Miranda | 10
					pessoas</button>
				<button id="btsearch7" class="item-search" style="display: none;">CWB - Sala Maria da Penha | 4
					pessoas</button>
				<button id="btsearch8" class="item-search" style="display: none;">CWB - Sala Domingos Pellegrini | 4
					pessoas</button>
				<button id="btsearch9" class="item-search" style="display: none;">CWB - Sala Mário de Andrade | 4
					pessoas</button>
				<button id="btsearch10" class="item-search" style="display: none;">CWB - Sala Darcy Ribeiro | 4
					pessoas</button>
				<button id="btsearch11" class="item-search" style="display: none;">CWB - Sala Mário Sérgio Cortella | 4
					pessoas</button>
				<button id="btsearch12" class="item-search" style="display: none;">CWB - Sala Hélio Leites | 2
					pessoas</button>
				<button id="btsearch13" class="item-search" style="display: none;">CWB - Sala Hipátia | 2
					pessoas</button>
				<button id="btsearch14" class="item-search" style="display: none;">CWB - Sala Magda Soares | 2
					pessoas</button>
				<button id="btsearch15" class="item-search" style="display: none;">CWB - Sala Alan Turing | 8
					pessoas</button>
				<button id="btsearch16" class="item-search" style="display: none;">CWB - Sala Lady Murasaki | 4
					pessoas</button>
				<button id="btsearch17" class="item-search" style="display: none;">CWB - Sala Marie Curie | 10
					pessoas</button>
				<button id="btsearch18" class="item-search" style="display: none;">CWB - Sala Katherine Johnson | 4
					pessoas</button>
				<button id="btsearch19" class="item-search" style="display: none;">CWB - Sala Isaac Newton | 4
					pessoas</button>
				<button id="btsearch20" class="item-search" style="display: none;">CWB - Sala Zaha Hadid | 4
					pessoas</button>
				<button id="btsearch21" class="item-search" style="display: none;">CWB - Arquibancada | 85
					pessoas</button>
				<button id="btsearch22" class="item-search" style="display: none;">CWB - Sala Câmara Cascudo | 1
					pessoa</button>
				<button id="btsearch23" class="item-search" style="display: none;">CWB - Sala Ariano Suassuna | 1
					pessoa</button>
				<button id="btsearch24" class="item-search" style="display: none;">CWB - Sala César Lattes | 10
					pessoas</button>
				<button id="btsearch25" class="item-search" style="display: none;">CWB - Sala Leonardo da Vinci | 25
					pessoas</button>
				<button id="btsearch26" class="item-search" style="display: none;">CWB - Sala Ada Lovelace | 4
					pessoas</button>
				<button id="btsearch27" class="item-search" style="display: none;">CWB - Sala Santos Dumont | 4
					pessoas</button>
			</section>
			<footer class="modal-card-foot">
				<div class="buttons">

					<button class="button" onclick="closeModal()">Fechar</button>
				</div>
			</footer>
		</div>
	</div>
	<div id="info" class="hide">

	</div>
	<canvas id="renderCanvas"></canvas>
	<script type="text/javascript">

		document.addEventListener('DOMContentLoaded', () => {
			// Get all "navbar-burger" elements
			const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

			// Add a click event on each of them
			$navbarBurgers.forEach(el => {
				el.addEventListener('click', () => {
					// Get the target from the "data-target" attribute
					const target = el.dataset.target;
					const $target = document.getElementById(target);

					// Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
					el.classList.toggle('is-active');
					$target.classList.toggle('is-active');

				});
			});

		});


		var canvas = document.getElementById("renderCanvas");

		var camera, scene, target, aniParado, aniVoando, aniForca;
		var scene;
		var salas = [];
		var chao = [];
		var predio;
		var isActive = false;
		var pathTextures;




		var materialSalas;
		var matChao;
		var materialXray;

		var engine = new BABYLON.Engine(canvas, true);

		function closeModal() {
			document.getElementById('searchModal').style.display = 'none'
		}
		function copyCanvasContentsToClipboard() {
			BABYLON.Tools.CreateScreenshotUsingRenderTarget(engine, camera, { width: 1920, height: 1080 });
		}

		var createScene = function () {
			scene = new BABYLON.Scene(engine);
			//scene.clearColor = new BABYLON.Color3(1, 1, 1);
			scene.clearColor = new BABYLON.Color4(0, 0, 0, 0); // Set the clear color to transparent

			var hdrTexture = BABYLON.CubeTexture.CreateFromPrefilteredData("meshes/environment.dds", scene);



			materialXray = new BABYLON.PBRMaterial("materialXray", scene);
			materialXray.reflectionTexture = hdrTexture;
			materialXray.metallic = 0.85;
			materialXray.roughness = 0.2;
			materialXray.alpha = 1;
			materialXray.albedoColor = new BABYLON.Color3.FromHexString('#0022FF'); // Blue color for xray material
			materialXray.reflectivityColor = new BABYLON.Color3(0.003, 0.003, 0.003);
			anime({
				targets: materialXray,
				alpha: 0.25, // target x position
				duration: 2000, // duration of the animation in milliseconds
				easing: 'easeInOutQuad' // easing function
			});

			materialSalas = new BABYLON.PBRMaterial("materialXray", scene);
			materialSalas.reflectionTexture = hdrTexture;
			materialSalas.metallic = 0.5;
			materialSalas.roughness = 0.52;
			materialSalas.alpha = 0.5;
			materialSalas.emissiveIntensity = 0.1; // Set emissive power for salas material
			materialSalas.emissiveColor = new BABYLON.Color3.FromHexString('#FF5E00'); // Set emissive color for salas material
			materialSalas.albedoColor = new BABYLON.Color3.FromHexString('#FF5E00'); // Orange color for xray material
			//materialSalas.reflectivityColor = new BABYLON.Color3(0.003, 0.003, 0.003);

			matChao = new BABYLON.PBRMaterial("materialXray", scene);
			matChao.reflectionTexture = hdrTexture;
			matChao.metallic = 0.85;
			matChao.roughness = 0.2;
			matChao.alpha = 1;
			matChao.albedoColor = new BABYLON.Color3.FromHexString('#0022FF'); // Blue color for xray material
			matChao.reflectivityColor = new BABYLON.Color3(0.003, 0.003, 0.003);



			target = new BABYLON.TransformNode('target', scene);
			target.position.y = 2;
			target.position.x = 2;
			target.position.z = -2;
			// Create a new ArcRotateCamera named "Camera" with initial parameters
			// Create a new ArcRotateCamera named "Camera" with initial parameters
			camera = new BABYLON.ArcRotateCamera("Camera", 0, 0, 5, new BABYLON.Vector3(0, 0, 0), scene);
			// Parameters:
			// - "Camera": The name of the camera
			// - 0: Alpha, the rotation around the Y axis
			// - 0: Beta, the rotation around the X axis
			// - 10: Radius, the distance from the target
			// - new BABYLON.Vector3(0, 0, 0): The target position of the camera
			// - scene: The scene where the camera belongs
			camera.setPosition(new BABYLON.Vector3(0, 0, 10));
			camera.attachControl(canvas, true);
			camera.panningSensibility = 0;
			camera.upperBetaLimit = 1.2;
			camera.lowerRadiusLimit = 8; // Set the lower limit of the camera's radius to its current radius to block zooming in
			camera.upperRadiusLimit = 25; // Set the upper limit of the camera's radius to its current radius to block zooming out
			anime({
				targets: camera.position,
				x: 20, // target x position
				y: 20, // target y position
				z: 20, // target z position
				duration: 2000, // duration of the animation in milliseconds
				easing: 'easeInOutQuad', // easing function
				update: function () {
					camera.setTarget(BABYLON.Vector3.Zero());
				}
			});


			/*directional light is defined by a direction (what a surprise!). The light is emitted from everywhere in the specified direction, and has an infinite range. An example of a directional light is when a distant planet is lit by the apparently parallel lines of light from its sun. Light in a downward direction will light the top of an object.
		   */
			const light0 = new BABYLON.DirectionalLight("DirectionalLight", new BABYLON.Vector3(3, 2, 2), scene);

			const shadowGenerator = new BABYLON.ShadowGenerator(1024, light0);

			var light = new BABYLON.HemisphericLight("HemiLight", new BABYLON.Vector3(0, 1, 0), scene);
			light.intensity = 1;

			BABYLON.SceneLoader.ImportMesh("", "meshes/", "hub.glb", scene, function (newMeshes, particleSystems, skeletons) {

				for (i = 0; i < newMeshes.length; i++) {
					console.log(newMeshes[i].name)
					if (newMeshes[i].name == "sae") {
						predio = newMeshes[i];
					}
					if (newMeshes[i].name.includes("chao")) {
						newMeshes[i].material = materialXray;
						chao.push(newMeshes[i])
					}
					if (newMeshes[i].name.includes("sala")) {
						newMeshes[i].material = materialSalas;
						salas.push(newMeshes[i])
					}


				}
				const gl = new BABYLON.GlowLayer("glow", scene);
				gl.intensity = 0.85;
			});

			scene.onBeforeCameraRenderObservable.add(() => {
				camera.setTarget(target.position)
			})

			const buttonsSearch = document.querySelectorAll('.item-search');
			buttonsSearch.forEach(button => {
				button.onclick = function () {
					const id = button.id.substring(8);

					changesala(parseInt(id));
					closeModal();
				};
			});

			const buttons = document.querySelectorAll('.bt');
			buttons.forEach(button => {
				button.onclick = function () {
					const id = button.id.substring(6);
					changesala(parseInt(id));
				};
			});


			function changesala(_id) {
				document.querySelector('#info').classList.remove("hide");
				document.querySelector('#info').innerHTML = document.querySelector('#btsearch' + _id).innerHTML;
				for (let ch of chao) {
					ch.material = materialXray;
				}
				for (let sala of salas) {
					if (sala.name === "sala" + _id) {
						sala.material = materialSalas;
						if (_id < 15) {
							chao1 = chao.find(chao => chao.name === "chao1");
							chao1.material = matChao;
						}
						if (_id >= 15) {
							chao1 = chao.find(chao => chao.name === "chao2");
							chao1.material = matChao;
						}
						changesalaAnime(sala);
					} else {
						sala.material = materialXray;
					}
				}


			}
			function changesalaAnime(_qual) {
				// Add your code here for the changesala function
				console.log("Changing sala...", _qual.name);
				predio.material = materialXray
				anime({
					targets: target.position,
					x: _qual.position.x * -1,
					y: _qual.position.y,
					z: _qual.position.z,
					duration: 1500,
					easing: 'easeInOutQuad'
				});

				anime({
					targets: camera,
					radius: 8,
					duration: 1500, // duration of the animation in milliseconds
					easing: 'easeInOutQuad' // easing function

				});
				anime({
					targets: materialXray,
					alpha: 0.2, // target x position
					duration: 1500, // duration of the animation in milliseconds
					easing: 'easeInOutQuad' // easing function
				});

				anime({
					targets: materialSalas,
					emissiveIntensity: 1, // target x position
					duration: 1500, // duration of the animation in milliseconds
					easing: 'easeInOutQuad' // easing function
				});

			}

			return scene;


		};

		scene = createScene();
		engine.runRenderLoop(function () {

			scene.render();


		});

	</script>
</body>

</html>